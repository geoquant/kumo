<!DOCTYPE html>
<html>
<head>
    <title>Cross-Boundary Test</title>
    <style>
        body { font-family: sans-serif; padding: 50px; background: #fafafa; }
        .host-app-card { border: 1px solid #ccc; padding: 20px; background: white; width: 300px; }
    </style>
</head>
<body>
    <h1>Gemini/ChatGPT Simulator</h1>
    <p>This is a third-party site loading Cloudflare's library.</p>

    <div class="host-app-card">
        <h3>Configure Worker:</h3>
        
        <div id="kumo-input-root"></div>
        <div id="kumo-select-root" style="margin-top: 15px;"></div>
        <div id="kumo-button-root" style="margin-top: 15px;"></div>
        <div id="kumo-layercard-root" style="margin-top: 15px;"></div>

        <button id="theme-toggle">Toggle Dark Mode</button>
    </div>

    <hr style="margin: 40px 0;">

    <div class="host-app-card">
        <h3>JSON-Based Rendering (New!):</h3>
        <p style="font-size: 12px; color: #666;">Using renderFromJSON method for generative UI</p>
        
        <div id="json-render-root" style="margin-top: 15px;"></div>
        <button id="simulate-ai-stream" style="margin-top: 15px; padding: 10px; cursor: pointer;">
            Simulate AI Stream
        </button>
    </div>

    <script>
        window.onload = () => {
            const { render } = window.CloudflareKumo;

            // 1. Render Input
            render('Input', {
                label: 'Worker Name',
                placeholder: 'my-awesome-worker',
                onChange: (e) => console.log('Input value:', e.target.value)
            }, 'kumo-input-root');

            // 2. Render Select
            render('Select', {
                label: 'Environment',
                className: 'w-full mb-4', // Passing Tailwind classes here
                options: [
                    { label: 'US East (Newark)', value: 'us-east' },
                    { label: 'Western Europe (London)', value: 'eu-west' },
                    { label: 'Asia Pacific (Tokyo)', value: 'ap-tokyo' }
                ],
                onValueChange: (val) => console.log('Selected:', val)
            }, 'kumo-select-root');

            // 3. Render Button
            render('Button', {
                children: 'Save Configuration', // This is what shows up as the title
                variant: 'primary',
                onClick: () => console.log('Saved!')
            }, 'kumo-button-root');

            // 4. Render LayerCard
            render('LayerCard', {
                className: 'w-full max-w-md',
                secondary: 'Configure Worker Settings',
                primaryClassName: 'flex flex-col gap-2',
                primary: [
                    { 
                        component: 'Input', 
                        props: { label: 'Worker Name', placeholder: 'my-worker', className: 'mb-2', onChange: (e) => console.log('Input value:', e.target.value) } 
                    },
                    { 
                        component: 'Select', 
                        props: { 
                            label: 'Region', 
                            placeholder: 'Choose a location...',
                            options: [
                                { label: 'US East (Newark)', value: 'us-east' },
                                { label: 'Western Europe (London)', value: 'eu-west' },
                                { label: 'Asia Pacific (Tokyo)', value: 'ap-tokyo' }
                            ],
                            className: 'w-full',
                            onValueChange: (val) => console.log('Selected:', val)
                        } 
                    },
                    { 
                        component: 'Button', 
                        props: { children: 'Save', variant: 'primary', onClick: () => console.log('Saved 2!') }
                    }
                ]
            }, 'kumo-layercard-root');
        };
    </script>

    <script>
        let currentMode = 'light';
        
        document.getElementById('theme-toggle').onclick = () => {
            currentMode = currentMode === 'light' ? 'dark' : 'light';
            
            // This is the magic line that updates all Kumo components on the page
            window.CloudflareKumo.setTheme(currentMode);
            
            // Optional: Update your host site's body too
            document.body.style.background = currentMode === 'dark' ? '#111' : '#fafafa';
        };

        // NEW: Demonstrate JSON-based rendering for generative UI
        document.getElementById('simulate-ai-stream').onclick = () => {
            // This simulates what an AI would return as it streams a response
            const jsonFromAI = {
                component: 'LayerCard',
                props: {
                    className: 'w-full',
                    secondary: 'AI-Generated Configuration',
                    primaryClassName: 'flex flex-col gap-3',
                    primary: [
                        { 
                            component: 'Input', 
                            props: { 
                                label: 'API Key', 
                                placeholder: 'sk-...', 
                                className: 'mb-2',
                                onChange: (e) => console.log('API Key:', e.target.value) 
                            } 
                        },
                        { 
                            component: 'Select', 
                            props: { 
                                label: 'Model', 
                                placeholder: 'Select a model...',
                                options: [
                                    { label: 'GPT-4', value: 'gpt-4' },
                                    { label: 'GPT-3.5 Turbo', value: 'gpt-3.5-turbo' },
                                    { label: 'Claude 3', value: 'claude-3' }
                                ],
                                className: 'w-full',
                                onValueChange: (val) => console.log('Model selected:', val)
                            } 
                        },
                        { 
                            component: 'Button', 
                            props: { 
                                children: 'Deploy AI Worker', 
                                variant: 'primary', 
                                onClick: () => alert('Deploying AI Worker!')
                            }
                        }
                    ]
                }
            };

            // This is the key line - pass JSON directly to renderFromJSON!
            window.CloudflareKumo.renderFromJSON(jsonFromAI, 'json-render-root');
        };
    </script>

    <script src="./dist/kumo-bundle.umd.cjs"></script>
    <link rel="stylesheet" href="./dist/style.css">
</body>
</html>