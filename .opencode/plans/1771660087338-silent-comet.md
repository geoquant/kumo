# Code Review: `geoquant/kumo-regression-prevention` Branch

3 review agents analyzed the 12-commit, 14-file, ~911-line diff across CI/workflow/build, test suite quality, and component fix/docs. Correlated findings below.

---

## Correlated Findings

### Critical / High (3)

| #   | Finding                                                                                                                                                      | Files                              | Reviewers   |
| --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------- | ----------- |
| 1   | **VR gate doesn't handle `cancelled` state** — falls through to misleading "exceeding threshold" error                                                       | `preview.yml:228`                  | CI reviewer |
| 2   | **Worker outage silently passes gate** — `isWorkerUnreachable` returns early with exit 0, skips PR comment. Persistent outage = silent VR bypass for all PRs | `run-visual-regression.ts:649-658` | CI reviewer |
| 3   | **5xx catch-all swallows real errors** — `isWorkerUnreachable` matches all 5xx including 500 (app bug). Should match only 502/503/504                        | `run-visual-regression.ts:87-96`   | CI reviewer |

### Medium (4)

| #   | Finding                                                                                                                          | Files                            | Reviewers          |
| --- | -------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- | ------------------ |
| 4   | **GH annotation title not URL-encoded** — `=` and `%` chars in titles break GH Actions parsing                                   | `run-visual-regression.ts:74-84` | CI reviewer        |
| 5   | **CSS contract error msg says "minor" but should say "major"** — removing public class is breaking change                        | `css-classes.test.ts:143`        | Test reviewer      |
| 6   | **Select component has same `overflow-hidden` pattern** — no `overflow-y-auto` on Select popup; latent scroll bug for long lists | `select/select.tsx:239`          | Component reviewer |
| 7   | **Beta ESLint plugin pinned** — `eslint-plugin-tailwindcss@4.0.0-beta.0`; mitigated by `warn` severity                           | `package.json:438`               | CI reviewer        |

### Low / Nit (10+)

| #   | Finding                                                                                                                | Reviewers          |
| --- | ---------------------------------------------------------------------------------------------------------------------- | ------------------ |
| 8   | Ternary exclusion in tailwind-conflicts too aggressive — could intersect both branches to detect unconditional classes | Test reviewer      |
| 9   | Missing `Object.groupBy`/`Map.groupBy` in banned API list (zero FP risk, high value)                                   | Test reviewer      |
| 10  | `Array.prototype.with()` regex could FP on builder patterns                                                            | Test reviewer      |
| 11  | `&&` mutual exclusion guards not analyzed (documented limitation, acceptable)                                          | Test reviewer      |
| 12  | Template literals in `cn()` silently ignored (none exist today)                                                        | Test reviewer      |
| 13  | No responsive-prefix conflict detection (none used in `cn()` today)                                                    | Test reviewer      |
| 14  | `CONFLICT_PAIRS` could expand: position, flex-direction, text-align                                                    | Test reviewer      |
| 15  | Tailwind conflicts test only scans `src/components/`, not `src/blocks/`/`src/catalog/`                                 | Component reviewer |
| 16  | Combobox line comment `// background` is now slightly inaccurate                                                       | Component reviewer |
| 17  | `.oxlintrc.json` uses JSONC comments in `.json` file                                                                   | CI reviewer        |
| 18  | Unused callees in ESLint tailwind config (`classnames`, `ctl`, `cva`, `tv`)                                            | CI reviewer        |

### Positive (confirmed correct)

- Combobox `overflow-x-hidden` fix is correct — axes don't conflict in tailwind-merge
- `patch` changeset is correct semver bump
- ES2022 target + browser-compat test + oxlint rule disabling = well-designed defense-in-depth
- `describe.skipIf(!isBuilt)` pattern is appropriate
- Type safety is excellent across all test files (no `any`, `readonly` arrays, `as const`)
- Error messages in all 3 test suites are exemplary (what/where/how-to-fix)
- `rollup-plugin-preserve-directives` removal is clean (was already dead code)
- AGENTS.md documentation is high quality and actionable

---

## Recommended Fixes (if acting on review)

### Must-fix before merge

1. **#1** — Add `cancelled` handling to VR gate job
2. **#3** — Narrow 5xx regex to `/Worker request failed: 50[234]\b/`
3. **#5** — Fix "minor version bump" → "major version bump" in CSS contract error msg

### Should-fix

4. **#2** — Post PR comment even on worker outage so reviewers see the skip
5. **#4** — URL-encode GH annotation title properties
6. **#9** — Add `Object.groupBy`/`Map.groupBy` to banned APIs

### Nice-to-have

7. **#8** — Ternary intersection improvement in tailwind-conflicts
8. **#6** — File follow-up issue for Select/Dropdown scroll audit
9. **#15** — Expand tailwind conflict scan to `src/blocks/` and `src/catalog/`
