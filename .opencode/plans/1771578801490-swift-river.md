# Plan: Review kumo-stream vs GENERATIVE-UI + commit

## Goal

- Validate `_examples/kumo-stream/` matches `_examples/GENERATIVE-UI.md` goals (discoverability endpoints, UMD loadable, CSS, registry hosting, streaming JSONL+RFC6902, action system, error boundaries, theme wrapper).
- Review current branch + uncommitted changes; correlate findings across code + diffs.
- Commit all intended changes (exclude secrets/build artifacts); follow repo conventions.

## Constraints

- Planning only: no code edits/commits yet.
- Must avoid committing secrets (`.env`, tokens) + avoid committing large generated build outputs unless repo already expects them.
- If changes touch `packages/kumo/`, likely need a changeset.

## What Iâ€™ll Inspect

- VCS status/diff/log for current branch.
- `_examples/kumo-stream/`:
  - `server/index.ts` (.well-known endpoints + streaming endpoint)
  - `vite.loadable.config.ts` (UMD build)
  - `public/cross-boundary.html` (plain HTML consumer)
  - `src/**` (renderer, JSONL parser, RFC6902, action registry/handlers, ThemeWrapper, ErrorBoundary)
- Any other changed files in branch.

## Output

- Gap table: spec item -> implementation evidence -> gaps/risks.
- Actionable fixes list (if gaps found).
- Draft commit message(s) consistent w/ repo history.

## Current Findings (exploration)

- Spec coverage: kumo-stream implements all 4 `.well-known` endpoints in `_examples/kumo-stream/server/index.ts` and includes plain-HTML consumer in `_examples/kumo-stream/public/cross-boundary.html`.
- Streaming pipeline present end-to-end for cross-boundary: server SSE (`/api/chat`) -> client SSE parser -> JSONL parser -> RFC6902 apply -> incremental renderer.
- Action system present: per-element actions -> `kumo-action` CustomEvent -> shared action registry -> result processor.

### Mismatches/gaps vs `_examples/GENERATIVE-UI.md`

- Theme event name: doc example uses `theme-change`, implementation uses `kumo-theme-change` (`_examples/kumo-stream/src/loadable/theme.tsx`).
- ErrorBoundary reference: doc mentions `loadable.tsx` class `ErrorBoundary`, actual is `ElementErrorBoundary` in `_examples/kumo-stream/src/core/UITreeRenderer.tsx`.
- React SPA mismatch: `ChatDemo` streams direct from Anthropic in-browser while discovery manifest advertises SSE `/api/chat`.
- `submit_form` prompt copy mismatch: `_examples/kumo-stream/src/core/system-prompt.ts` tells model to include field values in `params`, but the design doc prefers host-collected runtime values.
- Sanitization mismatch: React hook sanitizes patches (`_examples/kumo-stream/src/core/hooks.ts`), but the cross-boundary UMD patch path appears to apply raw ops.

### Risk worth hardening

- RFC6902 blocked path segments can devolve into replace/wipe when path segments end up empty; should be invalid op/no-op.

## Verification (after build phase)

- Run example app, confirm:
  - `/.well-known/generative-ui.json` returns correct metadata.
  - `/.well-known/component-loadable.umd.js`, `/.well-known/stylesheet.css`, `/.well-known/component-registry.json` served.
  - Plain HTML page renders via script tag.
  - SSE stream -> JSONL parser -> RFC6902 -> incremental render.
  - Actions (increment/decrement/submit/navigate) work.

## Planned Work (build phase)

1. Align docs + implementation around theme event name + ErrorBoundary reference.
2. Align `submit_form` guidance in `_examples/kumo-stream/src/core/system-prompt.ts` with host-collected runtime values.
3. Align SPA `ChatDemo` with SSE `/api/chat` (recommended: remove/avoid browser key path).
4. Apply `sanitizePatch` consistently in UMD patch application path.
5. Harden RFC6902 invalid/blocked paths: never replace/wipe whole tree.
6. Run example tests; then stage/commit intended changes only (exclude `.env`, `node_modules/`, local plans).

## Open Questions

- None yet.
